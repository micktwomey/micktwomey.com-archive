{
	"version": "https://jsonfeed.org/version/1",
	"title": "Michael Twomey's Blog",
	"icon": "https://micro.blog/micktwomey/avatar.jpg",
	"home_page_url": "https://micktwomey.com/",
	"feed_url": "https://micktwomey.com/feed.json",
	"items": [
		
			{
				"id": "http://micktwomey.micro.blog/2025/04/17/pin-your-github-actions-just/",
				"title": "Pin your GitHub Actions",
				"content_html": "<p>Just going to echo this post:</p>\n<!-- raw HTML omitted -->\n<p>Pin your actions!</p>\n<p>I&rsquo;ve done it in my work, and while it&rsquo;s a little tedious to setup initially it&rsquo;s not to bad with dependabot updating them automatically.</p>\n",
				"content_text": "Just going to echo this post:\n\n<blockquote class=\"quoteback\" data-author=\"michaelheap.com\" data-avatar=\"https://micro.blog/michaelheap.com/avatar.jpg\" cite=\"https://michaelheap.com/pin-your-github-actions/\"><p>Pin your GitHub Actions <a href=\"https://michaelheap.com/pin-your-github-actions/\">michaelheap.com</a></p><footer>michaelheap.com <cite><a href=\"https://michaelheap.com/pin-your-github-actions/\" class=\"u-in-reply-to\">https://michaelheap.com/pin-your-github-actions/</a></cite></footer></blockquote><script src=\"https://cdn.micro.blog/quoteback.js\"></script>\n\nPin your actions!\n\nI've done it in my work, and while it's a little tedious to setup initially it's not to bad with dependabot updating them automatically.\n",
				"date_published": "2025-04-17T21:12:17+01:00",
				"url": "https://micktwomey.com/2025/04/17/pin-your-github-actions-just/",
				"tags": ["security"]
			},
			{
				"id": "http://micktwomey.micro.blog/2025/02/15/my-first-playdate-game/",
				"title": "My First Playdate Game!",
				"content_html": "<p>I helped organize <a href=\"https://www.gamecraft.it/events/dublin-gamecraft-2025/\">Dublin GameCraft 2025</a>.</p>\n<p>I also created my first <a href=\"https://play.date/\">Playdate</a> game:</p>\n<!-- raw HTML omitted -->\n<p>The theme was pop and I really wanted to use the crank somehow.</p>\n<p>I have to say, I really enjoyed the process of developing for the Playdate. It helps that the SDK was heavily inspired by <a href=\"https://www.love2d.org/\">LÖVE</a>, which is a lovely development environment.</p>\n<p>You can see all the other submissions <a href=\"https://itch.io/jam/dublin-gamecraft-2025\">here</a>.</p>\n",
				"content_text": "I helped organize [Dublin GameCraft 2025](https://www.gamecraft.it/events/dublin-gamecraft-2025/).\n\nI also created my first [Playdate](https://play.date/) game:\n\n<iframe src=\"https://itch.io/embed/3330635\" width=\"552\" height=\"167\" frameborder=\"0\"><a href=\"https://micktwomey.itch.io/pop-your-bubble\">Pop Your Bubble by Michael Twomey</a></iframe>\n\nThe theme was pop and I really wanted to use the crank somehow.\n\nI have to say, I really enjoyed the process of developing for the Playdate. It helps that the SDK was heavily inspired by [LÖVE](https://www.love2d.org/), which is a lovely development environment.\n\nYou can see all the other submissions [here](https://itch.io/jam/dublin-gamecraft-2025).\n",
				"date_published": "2025-02-15T12:00:00+01:00",
				"url": "https://micktwomey.com/2025/02/15/my-first-playdate-game/",
				"tags": ["games","gamecraft","events","playdate"]
			},
			{
				"id": "http://micktwomey.micro.blog/2024/12/10/postgresql-not-null-can-be/",
				"title": "PostgreSQL NOT NULL can be added without locking",
				"content_html": "<p>There&rsquo;s bit of an interesting rabbit hole with NOT NULL constraints vs locking up your DB.</p>\n<p>It starts with &ldquo;is a NOT NULL check contraint worse than a NOT NULL&rdquo;?</p>\n<p>The docs hint at some difference: <a href=\"https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-NOT-NULL\">https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-NOT-NULL</a></p>\n<p>SO thread: <a href=\"https://dba.stackexchange.com/questions/158499/postgres-how-is-set-not-null-more-efficient-than-check-constraint\">https://dba.stackexchange.com/questions/158499/postgres-how-is-set-not-null-more-efficient-than-check-constraint</a></p>\n<p>Which points to <a href=\"https://dba.stackexchange.com/questions/66840/add-not-null-constraint-to-large-table-without-table-scan\">https://dba.stackexchange.com/questions/66840/add-not-null-constraint-to-large-table-without-table-scan</a></p>\n<p>Which finally points to <a href=\"https://dba.stackexchange.com/questions/267947/how-can-i-set-a-column-to-not-null-without-locking-the-table-during-a-table-scan/268128#268128\">https://dba.stackexchange.com/questions/267947/how-can-i-set-a-column-to-not-null-without-locking-the-table-during-a-table-scan/268128#268128</a></p>\n<p>The big problem is adding a NOT NULL constraint can badly lock up the table and other sessions.</p>\n<p>Using a constraint with <code>NOT VALID</code> and then validating later is a work around.</p>\n<p>There&rsquo;s a third step you can do: add a <code>NOT NULL</code> after this an PostgreSQL will do a no-lock update.</p>\n<p>First add the constraint:</p>\n<div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"><code class=\"language-sql\" data-lang=\"sql\"><span style=\"color:#75715e\">-- short-time exclusive lock\n</span><span style=\"color:#75715e\"></span><span style=\"color:#66d9ef\">alter</span> <span style=\"color:#66d9ef\">table</span> foos \n  <span style=\"color:#66d9ef\">add</span> <span style=\"color:#66d9ef\">constraint</span> foos_not_null \n  <span style=\"color:#66d9ef\">check</span> (bar1 <span style=\"color:#66d9ef\">is</span> <span style=\"color:#66d9ef\">not</span> <span style=\"color:#66d9ef\">null</span>) <span style=\"color:#66d9ef\">not</span> <span style=\"color:#66d9ef\">valid</span>;\n</code></pre></div><p>Next validate it:</p>\n<div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"><code class=\"language-sql\" data-lang=\"sql\"><span style=\"color:#75715e\">-- seqscan, but without exclusive lock, concurrent sessions can read/write\n</span><span style=\"color:#75715e\"></span><span style=\"color:#66d9ef\">alter</span> <span style=\"color:#66d9ef\">table</span> foos validate <span style=\"color:#66d9ef\">constraint</span> foos_not_null;\n</code></pre></div><p>Finally add not null and drop constraint:</p>\n<div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"><code class=\"language-sql\" data-lang=\"sql\"><span style=\"color:#75715e\">-- exclusive lock, but foos_not_null proves: there is no NULL in this column\n</span><span style=\"color:#75715e\">-- so this alter table would be fast\n</span><span style=\"color:#75715e\"></span><span style=\"color:#66d9ef\">alter</span> <span style=\"color:#66d9ef\">table</span> foos <span style=\"color:#66d9ef\">alter</span> <span style=\"color:#66d9ef\">column</span> bar1 <span style=\"color:#66d9ef\">set</span> <span style=\"color:#66d9ef\">not</span> <span style=\"color:#66d9ef\">null</span>;\n<span style=\"color:#75715e\">-- not needed anymore\n</span><span style=\"color:#75715e\"></span><span style=\"color:#66d9ef\">alter</span> <span style=\"color:#66d9ef\">table</span> foos <span style=\"color:#66d9ef\">drop</span> <span style=\"color:#66d9ef\">constraint</span> foos_not_null;\n</code></pre></div><p>There is also an approach of adding  a NOT NULL with a default value, PostgreSQL optimizes this case: <a href=\"https://brandur.org/postgres-default\">https://brandur.org/postgres-default</a></p>\n<div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"><code class=\"language-sql\" data-lang=\"sql\"><span style=\"color:#66d9ef\">ALTER</span> <span style=\"color:#66d9ef\">TABLE</span> users\n    <span style=\"color:#66d9ef\">ADD</span> <span style=\"color:#66d9ef\">COLUMN</span> credits bigint <span style=\"color:#66d9ef\">NOT</span> <span style=\"color:#66d9ef\">NULL</span> <span style=\"color:#66d9ef\">DEFAULT</span> <span style=\"color:#ae81ff\">0</span>;\n</code></pre></div>",
				"content_text": "There's bit of an interesting rabbit hole with NOT NULL constraints vs locking up your DB.\n\nIt starts with \"is a NOT NULL check contraint worse than a NOT NULL\"?\n\nThe docs hint at some difference: [https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-NOT-NULL](https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-NOT-NULL)\n\nSO thread: [https://dba.stackexchange.com/questions/158499/postgres-how-is-set-not-null-more-efficient-than-check-constraint](https://dba.stackexchange.com/questions/158499/postgres-how-is-set-not-null-more-efficient-than-check-constraint)\n\nWhich points to [https://dba.stackexchange.com/questions/66840/add-not-null-constraint-to-large-table-without-table-scan](https://dba.stackexchange.com/questions/66840/add-not-null-constraint-to-large-table-without-table-scan)\n\nWhich finally points to [https://dba.stackexchange.com/questions/267947/how-can-i-set-a-column-to-not-null-without-locking-the-table-during-a-table-scan/268128#268128](https://dba.stackexchange.com/questions/267947/how-can-i-set-a-column-to-not-null-without-locking-the-table-during-a-table-scan/268128#268128)\n\n\n\nThe big problem is adding a NOT NULL constraint can badly lock up the table and other sessions.\n\nUsing a constraint with `NOT VALID` and then validating later is a work around.\n\nThere's a third step you can do: add a `NOT NULL` after this an PostgreSQL will do a no-lock update.\n\nFirst add the constraint:\n\n```sql\n-- short-time exclusive lock\nalter table foos \n  add constraint foos_not_null \n  check (bar1 is not null) not valid;\n```\nNext validate it:\n\n```sql\n-- seqscan, but without exclusive lock, concurrent sessions can read/write\nalter table foos validate constraint foos_not_null;\n```\nFinally add not null and drop constraint:\n\n```sql\n-- exclusive lock, but foos_not_null proves: there is no NULL in this column\n-- so this alter table would be fast\nalter table foos alter column bar1 set not null;\n-- not needed anymore\nalter table foos drop constraint foos_not_null;\n```\nThere is also an approach of adding  a NOT NULL with a default value, PostgreSQL optimizes this case: [https://brandur.org/postgres-default](https://brandur.org/postgres-default)\n\n```sql\nALTER TABLE users\n    ADD COLUMN credits bigint NOT NULL DEFAULT 0;\n```\n",
				"date_published": "2024-12-10T12:00:00+01:00",
				"url": "https://micktwomey.com/2024/12/10/postgresql-not-null-can-be/",
				"tags": ["TIL","postgresql"]
			}
	]
}
