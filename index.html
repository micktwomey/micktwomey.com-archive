<!DOCTYPE html>
<html>

  <head>
	<meta name="generator" content="Hugo 0.91.2" />

  <title>
      
      Michael Twomey&#39;s Blog
      
  </title>

</head>


  <body>

    

	
<div class="h-feed">

	
	
	  <div class="h-entry">
		
			<h1><a href="https://micktwomey.com/2025/04/17/pin-your-github-actions-just/">Pin your GitHub Actions</a></h1>
		

		<a href="https://micktwomey.com/2025/04/17/pin-your-github-actions-just/" class="u-url"><time class="dt-published" datetime="2025-04-17 21:12:17 &#43;0100">Apr 17, 2025</time></a>

		<div class="e-content">
			 <p>Just going to echo this post:</p>
<!-- raw HTML omitted -->
<p>Pin your actions!</p>
<p>I&rsquo;ve done it in my work, and while it&rsquo;s a little tedious to setup initially it&rsquo;s not to bad with dependabot updating them automatically.</p>

		</div>
	  </div>
	
	  <div class="h-entry">
		
			<h1><a href="https://micktwomey.com/2025/02/15/my-first-playdate-game/">My First Playdate Game!</a></h1>
		

		<a href="https://micktwomey.com/2025/02/15/my-first-playdate-game/" class="u-url"><time class="dt-published" datetime="2025-02-15 12:00:00 &#43;0100">Feb 15, 2025</time></a>

		<div class="e-content">
			 <p>I helped organize <a href="https://www.gamecraft.it/events/dublin-gamecraft-2025/">Dublin GameCraft 2025</a>.</p>
<p>I also created my first <a href="https://play.date/">Playdate</a> game:</p>
<!-- raw HTML omitted -->
<p>The theme was pop and I really wanted to use the crank somehow.</p>
<p>I have to say, I really enjoyed the process of developing for the Playdate. It helps that the SDK was heavily inspired by <a href="https://www.love2d.org/">LÃ–VE</a>, which is a lovely development environment.</p>
<p>You can see all the other submissions <a href="https://itch.io/jam/dublin-gamecraft-2025">here</a>.</p>

		</div>
	  </div>
	
	  <div class="h-entry">
		
			<h1><a href="https://micktwomey.com/2024/12/10/postgresql-not-null-can-be/">PostgreSQL NOT NULL can be added without locking</a></h1>
		

		<a href="https://micktwomey.com/2024/12/10/postgresql-not-null-can-be/" class="u-url"><time class="dt-published" datetime="2024-12-10 12:00:00 &#43;0100">Dec 10, 2024</time></a>

		<div class="e-content">
			 <p>There&rsquo;s bit of an interesting rabbit hole with NOT NULL constraints vs locking up your DB.</p>
<p>It starts with &ldquo;is a NOT NULL check contraint worse than a NOT NULL&rdquo;?</p>
<p>The docs hint at some difference: <a href="https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-NOT-NULL">https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-NOT-NULL</a></p>
<p>SO thread: <a href="https://dba.stackexchange.com/questions/158499/postgres-how-is-set-not-null-more-efficient-than-check-constraint">https://dba.stackexchange.com/questions/158499/postgres-how-is-set-not-null-more-efficient-than-check-constraint</a></p>
<p>Which points to <a href="https://dba.stackexchange.com/questions/66840/add-not-null-constraint-to-large-table-without-table-scan">https://dba.stackexchange.com/questions/66840/add-not-null-constraint-to-large-table-without-table-scan</a></p>
<p>Which finally points to <a href="https://dba.stackexchange.com/questions/267947/how-can-i-set-a-column-to-not-null-without-locking-the-table-during-a-table-scan/268128#268128">https://dba.stackexchange.com/questions/267947/how-can-i-set-a-column-to-not-null-without-locking-the-table-during-a-table-scan/268128#268128</a></p>
<p>The big problem is adding a NOT NULL constraint can badly lock up the table and other sessions.</p>
<p>Using a constraint with <code>NOT VALID</code> and then validating later is a work around.</p>
<p>There&rsquo;s a third step you can do: add a <code>NOT NULL</code> after this an PostgreSQL will do a no-lock update.</p>
<p>First add the constraint:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- short-time exclusive lock
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> foos 
  <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">constraint</span> foos_not_null 
  <span style="color:#66d9ef">check</span> (bar1 <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">valid</span>;
</code></pre></div><p>Next validate it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- seqscan, but without exclusive lock, concurrent sessions can read/write
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> foos validate <span style="color:#66d9ef">constraint</span> foos_not_null;
</code></pre></div><p>Finally add not null and drop constraint:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- exclusive lock, but foos_not_null proves: there is no NULL in this column
</span><span style="color:#75715e">-- so this alter table would be fast
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> foos <span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">column</span> bar1 <span style="color:#66d9ef">set</span> <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>;
<span style="color:#75715e">-- not needed anymore
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> foos <span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">constraint</span> foos_not_null;
</code></pre></div><p>There is also an approach of adding  a NOT NULL with a default value, PostgreSQL optimizes this case: <a href="https://brandur.org/postgres-default">https://brandur.org/postgres-default</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> users
    <span style="color:#66d9ef">ADD</span> <span style="color:#66d9ef">COLUMN</span> credits bigint <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#ae81ff">0</span>;
</code></pre></div>
		</div>
	  </div>
	

</div>


    
    

  </body>

</html>
